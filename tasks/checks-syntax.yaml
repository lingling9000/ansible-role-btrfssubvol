---
# tasks file for btrfssubvol

- name: Check public role variable syntax
  ansible.builtin.assert:
    that:
      # btrfssubvol_device_uuid is a string
      - btrfssubvol_device_uuid is defined
      - btrfssubvol_device_uuid is not none
      - btrfssubvol_device_uuid is string
      - btrfssubvol_device_uuid | length > 0

      # btrfssubvol_rootvol_mount_point is a string
      - btrfssubvol_rootvol_mount_point is defined
      - btrfssubvol_rootvol_mount_point is not none
      - btrfssubvol_rootvol_mount_point is string
      - btrfssubvol_rootvol_mount_point | length > 0

      # btrfssubvol_subvolumes is a list
      - btrfssubvol_subvolumes is defined
      - btrfssubvol_subvolumes is not none
      - btrfssubvol_subvolumes is not string
      - btrfssubvol_subvolumes is not mapping
      - btrfssubvol_subvolumes is iterable
    fail_msg: Public role variable have bad syntax. Check your configuration.
    success_msg: Syntax correct for public role variables.
    quiet: true
  tags:
    - checks
    - checks-syntax

- name: Check btrfssubvol_subvolumes syntax
  ansible.builtin.assert:
    that:
      # subvolume.name is a string
      - subvolume.name is defined
      - subvolume.name is not none
      - subvolume.name is string
      - subvolume.name | length > 0

      # subvolume.owner is a string
      - (subvolume.owner is undefined) or (subvolume.owner is not none)
      - (subvolume.owner is undefined) or (subvolume.owner is string)
      - (subvolume.owner is undefined) or (subvolume.owner | length > 0)

      # subvolume.group is a string
      - (subvolume.group is undefined) or (subvolume.group is not none)
      - (subvolume.group is undefined) or (subvolume.group is string)
      - (subvolume.group is undefined) or (subvolume.group | length > 0)

      # subvolume.recurse is a boolean
      - (subvolume.recurse is undefined) or (subvolume.recurse is not none)
      - (subvolume.recurse is undefined) or (subvolume.recurse is boolean)
    fail_msg: |
      Item syntax of 'btrfssubvol_subvolumes' is faulty. Ensure your list items
      have following syntax:

      - name (string, mandatory)

      - owner (string, optional)
      - group (string, optional)
      - recurse (boolean, optional)

      Consult the documentation for further information on the values.
    success_msg: All items in 'btrfssubvol_subvolumes' have correct syntax.
    quiet: true
  loop: "{{ btrfssubvol_subvolumes }}"
  loop_control:
    loop_var: subvolume
  tags:
    - checks
    - checks-syntax

# End of file
