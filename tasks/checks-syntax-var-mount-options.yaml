---
# tasks file for btrfssubvol

# Following variables are expected, set them on the include:
#
#   - mount_options (list / elements=string). A list with the items to be
#     checked.
#   - label_for_check (string). The label used in the terminal output to
#     identify what is checked.

- name: "Check mount_options item syntax for {{ label_for_check | default('N/A') }}"
  ansible.builtin.assert:
    that:
      # mount_option is a string
      - mount_option is defined
      - mount_option is not none
      - mount_option is string
      - mount_option | length > 0
      - mount_option | ansible.builtin.split('=') | first not in ["subvol", "subvolid"]
    fail_msg: >
      The mount option '{{ mount_option }}' of {{ label_for_check }} is
      incorrect. Make sure all list items are strings. Additionally do not
      specify the mount options 'subvol' or 'subvolid'. They are generated by
      this role.

      For more information about the values, please refer to the documentation.
    success_msg: >
      All items in {{ label_for_check | default('N/A') }} have correct syntax.
    quiet: true
  loop: "{{ mount_options }}"
  loop_control:
    loop_var: mount_option
  tags:
    - checks
    - checks-syntax

# End of file
